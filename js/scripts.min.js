if ($('#videoPlayer').length) {
    $(window).load(function() {
        $('.spinner-wrapper').css('visibility', 'hidden');
        $('.play-wrapper').css('visibility', 'visible')
    })
}
if ($('#counter').length) {
    function addCommas(nStr) {
        nStr += '';
        x = nStr.split('.');
        x1 = x[0];
        x2 = x.length > 1 ? '.' + x[1] : '';
        var rgx = /(\d+)(\d{3})/;
        while (rgx.test(x1)) {
            x1 = x1.replace(rgx, '$1' + ',' + '$2')
        }
        return x1 + x2
    }

    function doSomething() {
        var min = $('#counter').data('min'),
            max = $('#counter').data('max'),
            number = Math.floor(Math.random() * (max - min + 1) + min);
        $('.counter-value').text(addCommas(number))
    }(function loop() {
        var rand = Math.round(Math.random() * (5000 - 500)) + 500;
        setTimeout(function() {
                doSomething();
                loop()
            },
            rand)
    }())
}

jQuery(document).ready(function($) {
    $('.nocontext').bind('contextmenu', function() {
        return false
    });
    $(document).click(function(event) {
        var clickover = $(event.target);
        var _opened = $(".navbar-collapse").hasClass("navbar-collapse in");
        if (_opened === true && !clickover.hasClass("navbar-toggle")) {
            $("button.navbar-toggle").click()
        }
    });
    if ($('[data-toggle="tooltip"]').length) {
        $('[data-toggle="tooltip"]').tooltip({
            container: "body"
        })
    }
    if ($('[data-toggle="popover"]').length) {
        $('[data-toggle="popover"]').popover({
            container: "body"
        })
    }
    $("#play,#play_btn").on('click', function(e) {
        $('.play-wrapper,#play .play-btn-border').css('display', 'none');
        $('.spinner-wrapper').css('visibility', 'visible');
        setTimeout(function() {
                exitFullscreen();
                $('#player-modal').modal('show')
            },
            3000);
        return false
    });
    $(".hq").on('click', function(e) {
        e.preventDefault();
        $(".hq").removeClass('active');
        $(this).addClass('active')
    });
    $(".btn-agree").on('click', function(e) {
        var id = $(this).data('cookie');
        setCookie(id, 'true');
        $('.alert-agree').hide()
    });
    $(document).on('click', '.icon-size-fullscreen', function(e) {
        e.preventDefault();
        launchIntoFullscreen(document.getElementById("video"))
    });
    $(document).on('click', '.icon-size-actual', function(e) {
        e.preventDefault();
        exitFullscreen()
    })
});

function setCookie(key, value) {
    var expires = new Date();
    expires.setTime(expires.getTime() + 31536000000);
    document.cookie = key + '=' + value + ';expires=' + expires.toUTCString()
}

function centerModals() {
    $('.modal').each(function(i) {
        var $clone = $(this).clone().css('display', 'block').appendTo('body');
        var top = Math.round(($clone.height() - $clone.find('.modal-content').height()) / 2);
        top = top > 0 ? top : 0;
        $clone.remove();
        $(this).find('.modal-content').css("margin-top", top)
    })
}
$('.modal').on('show.bs.modal', centerModals);
$(window).on('resize', centerModals);
$('.modal').on('hidden.bs.modal', function(e) {
    $(this).find('.modal-content').removeAttr('style');
    $(this).find('.modal-dialog').removeAttr('style');
    $('.spinner-wrapper').css('visibility', 'hidden');
    $('.play-wrapper,#play .play-btn-border').show();

});

function pad(n, width, z) {
    z = z || '0';
    n = n + '';
    return n.length >= width ? n : new Array(width - n.length + 1).join(z) + n
}

function launchIntoFullscreen(element) {
    if (element.requestFullscreen) {
        element.requestFullscreen()
    } else if (element.mozRequestFullScreen) {
        element.mozRequestFullScreen()
    } else if (element.webkitRequestFullscreen) {
        element.webkitRequestFullscreen()
    } else if (element.msRequestFullscreen) {
        element.msRequestFullscreen()
    }
    $(".icon-size-fullscreen").removeClass("icon-size-fullscreen").addClass("icon-size-actual")
}

function exitFullscreen() {
    if (document.exitFullscreen) {
        document.exitFullscreen()
    } else if (document.mozCancelFullScreen) {
        document.mozCancelFullScreen()
    } else if (document.webkitExitFullscreen) {
        document.webkitExitFullscreen()
    }
    $(".icon-size-actual").removeClass("icon-size-actual").addClass("icon-size-fullscreen")
}
$(document).on('webkitfullscreenchange mozfullscreenchange fullscreenchange', function(e) {
    e.preventDefault();
    var fullScreen = document.fullscreenElement || document.mozFullScreenElement || document.webkitFullscreenElement || document.msFullscreenElement ? true : false;
    if (fullScreen) {
        $(".icon-size-fullscreen").removeClass("icon-size-fullscreen").addClass("icon-size-actual")
    } else {
        $(".icon-size-actual").removeClass("icon-size-actual").addClass("icon-size-fullscreen")
    }
});


// custom scripts

async function handleLocalTopbar(modifyMode = false, data = null) {
    if (modifyMode) {
        $.ajax({
            url: location.href.split('?')[0] + 'sportData.json',
            type: 'GET',
            success: (res) => {
                let oldTopbar = JSON.parse(localStorage.getItem('topbar'));
                let newTopbar = JSON.parse(localStorage.getItem('topbar'));
                newTopbar.sort(function(x, y) { return x == data ? -1 : y == data ? 1 : 0; });
                $('.top-menu').children().each((index, element) => {
                    let onclickAttr = element.getAttribute('onclick');
                    element.setAttribute('onclick', onclickAttr.replace(oldTopbar[index], newTopbar[index]));
                    element.innerHTML = element.innerHTML.replace(res[oldTopbar[index]], res[newTopbar[index]]);
                });
                localStorage.setItem('topbar', JSON.stringify(newTopbar));
                let totalGenderSport = Object.keys(newTopbar).length;
                handleMainImage(newTopbar.at(Math.floor(Math.random() * totalGenderSport)), '#img-sport-left');
                handleMainImage(newTopbar.at(Math.floor(Math.random() * totalGenderSport)), '#img-sport-right');
            },
            error: (e) => {
                console.log(e);
            }
        });
    } else {
        $.ajax({
            url: location.href.split('?')[0] + 'topbar.json',
            type: 'GET',
            success: (res) => {
                console.log(res);
                localStorage.setItem('topbar', JSON.stringify(res));
            },
            error: (e) => {
                console.log(e);
            }
        });
    }
}

async function handleMainImage(genderSport, dom) {
    let tempInterval;
    $.ajax({
        url: location.href.split('?')[0] + 'scraper/metadata/?genderSport=' + genderSport,
        type: 'GET',
        beforeSend: () => {
            let num, text;
            tempInterval = setInterval(function() {
                num = new Date().getSeconds() % 3 + 1;
                text = '.'.repeat(num) + '%20'.repeat(3 - num);
                $(dom).attr('src', 'https://dummyimage.com/768x554/000000/ffffff&text=Loading' + text);
            }, 1000);
        },
        success: (res) => {
            clearInterval(tempInterval);
            if (res.status == 200) {
                if (res.image !== '' && res.image !== null) {
                    $(dom).attr('src', res.image);
                } else {
                    $(dom).attr('src', res.defaultImage);
                }
            } else {
                $(dom).attr('src', 'https://dummyimage.com/768x554/000000/ffffff&text=' + res.message);
            }
            // let baseHeight = $('.img-sport')[0].clientHeight;
            // $(dom).css('height', baseHeight + 'px');
        },
        error: (e) => {
            console.log(e);
        }
    });
}

async function loadMetadata(genderSport) {
    let tempInterval;
    $.ajax({
        url: location.href.split('?')[0] + 'scraper/metadata/?genderSport=' + genderSport,
        type: 'GET',
        beforeSend: () => {
            $('.top-menu').css('display', 'none');
            $('.loading-menu').css('display', '');
            let text, text2, num;
            tempInterval = setInterval(function() {
                num = new Date().getSeconds() % 3 + 1;
                text = '.'.repeat(num) + '%20'.repeat(3 - num);
                text2 = '.'.repeat(num);
                $('.img-sport').attr('src', 'https://dummyimage.com/768x554/000000/ffffff&text=Loading' + text);
                $('.loading-label').html('Loading' + text2);
            }, 1000);
        },
        success: (res) => {
            $('.top-menu').css('display', '');
            $('.loading-menu').css('display', 'none');
            clearInterval(tempInterval);
            if (res.status == 200) {
                if (res.image != '' && res.image !== null) {
                    $('.img-sport').attr('src', res.image);
                } else {
                    $('.img-sport').attr('src', res.defaultImage);
                }
            } else {
                $('.img-sport').attr('src', 'https://dummyimage.com/768x554/000000/ffffff&text=' + res.message);
            }
            let baseHeight = $('.img-sport')[0].clientHeight;
            // $('#img-sport-left').css('height', baseHeight + 'px');
            // $('#img-sport-right').css('height', baseHeight + 'px');
        },
        error: (e) => {
            console.log(e);
        }
    });
    let topbar = JSON.parse(localStorage.getItem('topbar'));
    let totalGenderSport;
    if (topbar) {
        totalGenderSport = Object.keys(topbar).length;
        handleMainImage(topbar.at(Math.floor(Math.random() * totalGenderSport)), '#img-sport-left');
        handleMainImage(topbar.at(Math.floor(Math.random() * totalGenderSport)), '#img-sport-right');
    } else {
        $.ajax({
            url: location.href.split('?')[0] + 'topbar.json',
            type: 'GET',
            success: (res) => {
                totalGenderSport = Object.keys(res).length;
                handleMainImage(res.at(Math.floor(Math.random() * totalGenderSport)), '#img-sport-left');
                handleMainImage(res.at(Math.floor(Math.random() * totalGenderSport)), '#img-sport-right');
                localStorage.setItem('topbar', JSON.stringify(res));
            },
            error: (e) => {
                console.log(e);
            }
        });
    }
}

async function changeParam(link) {
    window.history.pushState('page2', 'Title', link);
    let genderSport = link.split('genderSport=')[1];
    handleLocalTopbar(true, genderSport);
    loadMetadata(genderSport);
}

async function startUp() {
    var genderSport = new URL(location.href).searchParams.get("genderSport");
    await loadMetadata(genderSport);
    await handleLocalTopbar();
    if (genderSport) {
        await handleLocalTopbar(true, genderSport);
    }
}
startUp();